<!DOCTYPE html>
<html lang="es-PE">

<head>
    <title>CRUD PRODUCTOS</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">

    <!--ESTILOS ADICIONALES AGREGADOS-->
    <link rel="stylesheet" href="../resource/css/product.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/2.0.5/css/dataTables.bootstrap4.css" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="../resource/css/dataTables.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.dataTables.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <script src="https://code.jquery.com/jquery-3.7.0.js" type="text/Javascript"></script>
</head>

<body>

    <% if(login) { %>
        <div class="sidebar">
            <div class="logo-details">
                <i class='bx bxl-codepen icon'></i>
                <div class="logo_name">Urban Shoes</div>
                <i class='bx bx-menu' id="btn"></i>
            </div>
            <ul class="nav-list">
                <li>
                    <i class='bx bx-search'></i>
                    <input type="text" placeholder="Search...">
                    <span class="tooltip">Buscar</span>
                </li>
                <li>
                    <a href="admin">
                        <i class='bx bx-grid-alt'></i>
                        <span class="links_name">Principal</span>
                    </a>
                    <span class="tooltip">Principal</span>
                </li>
                <li>
                    <a href="#">
                        <i class='bx bx-user'></i>
                        <span class="links_name">Usuarios</span>
                    </a>
                    <span class="tooltip">Usuarios</span>
                </li>
                <li>
                    <a href="crudpersonas">
                        <i class='bx bx-chat'></i>
                        <span class="links_name">Personas</span>
                    </a>
                    <span class="tooltip">Personas</span>
                </li>
                <li class="parent">
                    <a href="crudproduct">
                        <i class='bx bx-package'></i>
                        <span class="links_name">Productos</span>
                    </a>
                    <span class="tooltip">Productos</span>
                        <i id="abrirsubproducto" class="bx bxs-chevron-left arrow"></i>
                        <ul class="sub-menu" id="submenu-productos">
                            <li>
                                <a href="#">
                                    <i class='bx bx-plus'></i>
                                    Agregar Producto
                                </a>
                            </li>
                        </ul>
                </li>
                <li>
                    <a href="#">
                        <i class='bx bx-folder'></i>
                        <span class="links_name">File Manager</span>
                    </a>
                    <span class="tooltip">Files</span>
                </li>
                <li>
                    <a href="#">
                        <i class='bx bx-cart-alt'></i>
                        <span class="links_name">Order</span>
                    </a>
                    <span class="tooltip">Order</span>
                </li>
                <li>
                    <a href="#">
                        <i class='bx bx-heart'></i>
                        <span class="links_name">Saved</span>
                    </a>
                    <span class="tooltip">Saved</span>
                </li>
                <li>
                    <a href="#">
                        <i class='bx bx-cog'></i>
                        <span class="links_name">Setting</span>
                    </a>
                    <span class="tooltip">Setting</span>
                </li>

                <li>
                    <a href="#">
                        <i class='bx bxs-user-circle'></i>
                        <span class="links_name">
                            <%= name %>
                        </span>
                    </a>
                    <span class="tooltip">
                        <%= name %>
                    </span>
                </li>

                <li class="profile">
                    <div class="profile-details">
                        <i class='bx bx-export'></i>
                        <div class="name_job">
                            <div class="name">Logout</div>
                        </div>
                    </div>
                    <a href="logout">
                        <i class='bx bx-log-out' id="log_out"></i>
                    </a>
                </li>
            </ul>
        </div>
        <% } %>

            <section class="home-section">
                <div class="title">PRODUCTOS</div>

                <div class="modesys">
                    
                    <label class="switch">
                        <input type="checkbox" id="input">
                        <span class="slider"></span>
                    </label>
                    <div class="select-image">
                        <img src="../resource/img/plus/dark.svg" style="width: 169px; height: 80px;" alt="Dark Mode"
                            id="darkImage">
                        <img src="../resource/img/plus/light.svg" style="width: 169px; height: 80px;" alt="Light Mode"
                            id="lightImage">
                    </div>

                </div>
                <div class="table-responsive">

                    <a href="#" class="btn-register">Registrar Producto</a>

                    <div class="card-body">
                        <table id="myTable" class="content-table" style="width: 100%;">
                            <thead>
                                <tr>
                                    <!-- <th>ID</th>  -->
                                    <th>Nombre</th>
                                    <th>Imagen</th>
                                    <th>Género</th>
                                    <th>Categoria</th>
                                    <th>Precio</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% results.forEach((productos)=> { %>
                                    <tr class="active-row">
                                        <!-- <td>
                                        <%=productos.id %>
                                    </td>  -->
                                        <td>
                                            <%=productos.nombre %>
                                        </td>
                                        <td>
                                            <img id="vistaPreviaImagen" src="../resource/img/product/<%=productos.imagen %>" width="40px" height="50px">
                                        </td>
                                        <td>
                                            <%=productos.genero %>
                                        </td>
                                        <td>
                                            <%=productos.categoria %>
                                        </td>
                                        <td>
                                            <%=productos.precio %>
                                        </td>
                                        <td>
                                            <!-- <a href="#" data-bs-toggle="modal"
                                        data-bs-target="#modalupdate_<%= productos.id %>" class="btn btn-editar">
                                        <i class="bx bxs-edit-alt"></i>
                                        </a>

                                        <a href="/eliminar/<%= productos.id %>"
                                        class="btn btn-eliminar">
                                        <i class="bx bxs-trash"></i>
                                        </a> -->
                                            <a href="#" class="btn btn-edit"><i class='bx bx-edit'></i> Editar</a>
                                            <a href="#" class="btn btn-delete"><i class='bx bx-trash'></i> Eliminar</a>
                                        </td>
                                    </tr>
                                    <% }) %>
                            </tbody>
                        </table>
                    </div>
                </div>

            </section>
            </div>

            <script src="../resource/js/dataTables.min.js"></script>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
            <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
            <!-- Previsualizacion de las imagenes 
            <script>
                function mostrarVistaPrevia(idInput, idImagen) {
                    var archivo = document.getElementById(idInput).files[0];
                    var vistaPrevia = document.getElementById(idImagen);
                    if (archivo) {
                        var lector = new FileReader();
                        lector.onload = function (e) {
                            vistaPrevia.src = e.target.result;
                            vistaPrevia.style.display = 'block';
                        }
                        lector.readAsDataURL(archivo);
                    }
                }  
            </script>
             Slug para cada producto 
            <script>
                document.getElementById('descripcion').addEventListener('input', function () {
                    var nombre = this.value.toLowerCase().trim();
                    // Reemplazar espacios en blanco con guiones
                    var slug = nombre.replace(/\s+/g, '-');
                    // Eliminar caracteres especiales
                    slug = slug.replace(/[^\w\-]+/g, '');
                    document.getElementById('slug').value = slug;
                });
            </script>
             Modificar las tallas 
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    const categoriaSelect = document.getElementById('categoria');
                    const tallasCalzado = document.getElementById('tallasCalzado');
                    const tallasRopa = document.getElementById('tallasRopa');

                    categoriaSelect.addEventListener('change', function () {
                        const categoriaSeleccionada = categoriaSelect.value;

                        // Ocultar todos los contenedores de tallas
                        tallasCalzado.style.display = 'none';
                        tallasRopa.style.display = 'none';

                        // Mostrar el contenedor de tallas correspondiente a la categoría seleccionada
                        if (categoriaSeleccionada === 'zapatilla' || categoriaSeleccionada === 'sandalia') {
                            tallasCalzado.style.display = 'block';
                        } else if (categoriaSeleccionada === 'polera' || categoriaSeleccionada === 'polo' || categoriaSeleccionada === 'camisa') {
                            tallasRopa.style.display = 'block';
                        }
                    });
                });
            </script>-->
            <!-- Abrir el navbar -->
            <script>
                let sidebar = document.querySelector(".sidebar");
                let closeBtn = document.querySelector("#btn");
                let searchBtn = document.querySelector(".bx-search");

                closeBtn.addEventListener("click", () => {
                    sidebar.classList.toggle("open");
                    menuBtnChange();
                });

                searchBtn.addEventListener("click", () => {
                    sidebar.classList.toggle("open");
                    menuBtnChange();
                });

                function menuBtnChange() {
                    if (sidebar.classList.contains("open")) {
                        closeBtn.classList.replace("bx-menu", "bx-menu-alt-right");
                    } else {
                        closeBtn.classList.replace("bx-menu-alt-right", "bx-menu");
                    }
                }
            </script>
            <!-- Modo Dark -->
            <script>

                // Detectar la preferencia del sistema
                const prefersDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

                // Obtener las imágenes
                const darkImage = document.getElementById('darkImage');
                const lightImage = document.getElementById('lightImage');

                // Función para aplicar el tema oscuro
                function applyDarkMode() {
                    document.body.classList.add('dark-mode');
                    darkImage.style.display = 'none';
                    lightImage.style.display = 'block';
                    document.getElementById('input').checked = true;
                }

                // Función para aplicar el tema claro
                function applyLightMode() {
                    document.body.classList.remove('dark-mode');
                    darkImage.style.display = 'block';
                    lightImage.style.display = 'none';
                }

                // Aplicar el tema según la preferencia guardada o la preferencia del sistema
                const selectedTheme = localStorage.getItem('theme');
                if (selectedTheme === 'dark' || (selectedTheme === null && prefersDarkMode)) {
                    applyDarkMode();
                } else {
                    applyLightMode();
                }

                // Cambiar el tema cuando se active el interruptor
                document.getElementById('input').addEventListener('change', () => {
                    if (document.body.classList.contains('dark-mode')) {
                        applyLightMode();
                        localStorage.setItem('theme', 'light'); // Guardar el tema seleccionado en el almacenamiento local
                    } else {
                        applyDarkMode();
                        localStorage.setItem('theme', 'dark'); // Guardar el tema seleccionado en el almacenamiento local
                    }
                });   
            </script>
            <!-- Data Table -->
            <script>
                let table = new DataTable('#myTable', {
                    language: { url: "../resource/json/mx.json" },
                    lengthMenu: [7, 10, 25, 50, 100],
                    responsive: true,
                    columnDefs: [
                        { responsivePriority: 1, target: 0 },
                        { responsivePriority: 1, target: 1 }
                        /*,
                        {
                            target: 3,
                            render: function (data, type, userRow) {
                                let classColor = 'text-success';
                                if (userRow[3] = 100) { classColor = 'text-warning' }
                                if (userRow[3] < 100) { classColor = 'text-danger' }
                                return '<span class=${classColor}>S/.{data}</span>'
                            }
                        }*/
                    ]
                });
                $(document).ready(function () {
                    $('#myTable').DataTable();
                });
            </script>
            <!-- Sub Menu Producto -->
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const submenuToggle = document.getElementById('abrirsubproducto');
                    const submenu = document.getElementById('submenu-productos');

                    submenuToggle.addEventListener('click', function(event) {
                        event.stopPropagation(); // Evita la redirección al hacer clic en el triángulo
                        this.classList.toggle('rotated');
                        submenu.classList.toggle('show');
                    });


                });


            </script>
            <!-- Previsualizar imagenes en la tabla -->
            <script>
                function mostrarVistaPrevia() {
                    var archivo = document.querySelector('input[type=file]').files[0];
                    var vistaPrevia = document.getElementById('vistaPreviaImagen');
            
                    if (archivo) {
                        var lector = new FileReader();
                        lector.onload = function(e) {
                        vistaPrevia.src = e.target.result;
                        vistaPrevia.style.display = 'block';
                    }
                    lector.readAsDataURL(archivo);
                    }
                }
            </script>

</body>

</html>